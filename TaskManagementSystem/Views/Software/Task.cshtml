
@{
    ViewBag.Title = "Task";
}

<head>
    @Styles.Render("~/Content/styleD.css")
</head>
@Html.Partial("NavBar")

<div class="container">
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h2>
                Task List
            </h2>
            <ol class="breadcrumb">
                <li><a href="../Software/Dashboard"><i class="fa fa-table"></i> Home</a></li>
                <li class="active">Task</li>
            </ol>
        </section>
        
        <form>
            <div id="theInputDate"></div>
            <wj-input-date value="theDate" min="2014-8-1" format="M/d/yyyy">
</form>
        <div class="btn-group-horizontal btn-sm pull-right">
            <button class="btn btn-info" id="" onclick="cmdShowAddModal_OnClick()"><i class="fa fa-plus"></i> Add</button>
            <a href="~/Software/Dashboard" class="btn btn-danger "><i class="fa fa-close"></i> Close</a>
        </div>

        <div id="userCollectionGrid"></div>

    </div>
        
</div>

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/software-js")

<script type="text/javascript">

    var clientList;
    var staffList;
    var userList;

    var cboBoxClientName;
    var cboBoxStaffName;
    var dateItem;
    var dateId;

    var inputDate;

    // =======================
    // Get UserMasterList Data
    // =======================

    function getUserMasterList() {
        var userList = new wijmo.collections.ObservableArray();

        $.ajax({
            url: '/api/task/listByDate/' + dateId,
            cache: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            //data: data,
            success: function (results) {
                var lastUser = 0;
                $("#loadingModal").modal("hide");
                if (results.length > 0) {
                    for (i = 0; i < results.length; i++) {
                        userList.push({
                            EditId: "<button class='btn btn-primary btn-xs btn-block' id='userEditButton' onClick='cmdUserEditButton_OnClick()'><i class='fa fa-bars'></i> View</button>",
                            DeleteId: "<button class='btn btn-danger btn-xs btn-block' id='userDeleteButton' onclick='cmdUserDeleteButton_OnClick()'><i class='fa fa-trash'></i> Delete</button>",
                            Id: results[i]["Id"],
                            TaskNo: results[i]["TaskNo"],
                            TaskDate: results[i]["TaskDate"],
                            ClientId: results[i]["ClientId"],
                            Caller: results[i]["Caller"],
                            ProductId: results[i]["ProductId"],
                            Concern: results[i]["Concern"],
                            Designation: results[i]["Designation"],
                            IsLocked: results[i]["IsLocked"]

                        });
                    }
                }
            }
        });

        return userList;
    }

    $(document).ready(function () {

        theDate = new Date();
        // create InputDate control
        inputDate = new wijmo.input.InputDate('#theInputDate', {
            min: new Date(2014, 8, 1),
            format: 'M/d/yyyy',
            value: theDate,
            onValueChanged: function () {
                dateId = [this.value.getMonth() + 1, this.value.getDate(), this.value.getFullYear()].join('-');
                console.log(dateId);

                userList = new wijmo.collections.CollectionView(getUserMasterList());

                userList.canFilter = true;
                userList.pageSize = 15;

                //Users - Flex Grid
                userGrid.itemsSource = userList;
                userGrid.trackChanges = true;
            }
        });
        //inputDate.valueChanged.addHandler(valueChanged);

        dateId = [inputDate.value.getMonth() + 1, inputDate.value.getDate(), inputDate.value.getFullYear()].join('-');
        console.log(dateId);

        userList = new wijmo.collections.CollectionView(getUserMasterList());

        userList.canFilter = true;
        userList.pageSize = 15;

        //Users - Flex Grid
        userGrid = new wijmo.grid.FlexGrid('#userCollectionGrid');
        userGrid.initialize({
            columns: [
            {
                "header": "View",
                "binding": "EditId",
                "width": 70,
                "align": "center",
                "isContentHtml": true
            },
            {
                "header": "Delete",
                "binding": "DeleteId",
                "width": 90,
                "align": "center",
                "isContentHtml": true

            },
            {
                "header": "Client",
                "binding": "ClientId",
                "align": "center",
                "allowSorting": true,
                "width": "2.5*"
            },
            {
                "header": "Staff Name",
                "binding": "ProductId",
                "align": "center",
                "allowSorting": true,
                "width": "4*"
            },
            {
                "header": "L",
                "binding": "IsLocked",
                "align": "center",
                "allowSorting": true,
                "width": "1.5*"
            }],
            autoGenerateColumns: false,
            itemsSource: userList,
            isReadOnly: true,
            autoSizeMode: wijmo.grid.AutoSizeMode.Both,
            allowDragging: wijmo.grid.AllowDragging.None,
            selectionMode: wijmo.grid.SelectionMode.Row
        });

        userGrid.trackChanges = true;

        // the date/time being edited


        //// create InputTime control
        //var inputTime = new wijmo.input.InputTime('#theInputTime', {
        //    min: new Date(2014, 8, 1, 9, 0),
        //    max: new Date(2014, 8, 1, 17, 0),
        //    step: 15,
        //    format: 'h:mm tt',
        //    value: theDate
        //});
        //inputTime.valueChanged.addHandler(valueChanged);

        //// create Calendar control
        //var calendar = new wijmo.input.Calendar('#theCalendar', {
        //    min: new Date(2014, 8, 1),
        //    value: theDate
        //});
        //calendar.valueChanged.addHandler(valueChanged);

        // udpate theDate when the value changes in any of the controls
        //function valueChanged(s, e) {
        //    theDate = s.value;
        //    inputDate.value = inputTime.value = calendar.value = theDate;
        //}

        
    });
</script>

@Html.Partial("Footer")